@page
@model CASPARWeb.Areas.Coord.Pages.BuildSchedule.UpsertModel
@{
}
<div class="card shadow border-0 mt-4 col-12 mx-auto">
	<div class="card-header bg-secondary bg-gradient ml-0 py-3">
		<div class="row">
			<div class="col-12 text-center">
				<h2 class="text-primary py-2">@(Model.objCourseSection.Id != 0 ? "Update " : "Add ") Course Section for @Model.objSemesterInstance.SemesterInstanceName</h2>
				<h5>@Model.objAcademicProgram.ProgramCode @Model.objCourse.CourseNumber @Model.objCourse.CourseTitle</h5>
			</div>
		</div>
	</div>

	
		<div class="card-body row">

		
		<!--Student Report-->
		<div class="col-3">
			<div class="card">
				<div class="card-header">
					<h5>Student Report</h5>
					<p>Course Demand: @Model.StudentCount</p>
				</div>
				<div class="card-body">
					<div class="row py-2">
						<div class="col-12">
							<label><h6>Modalities</h6></label>
							<hr />
							<div class="col-12 px-2" id="modalities">
								@foreach (var modality in Model.StudentModalityList.OrderByDescending(x => Model.ModalityCount.ContainsKey(x.Id) ? Model.ModalityCount[x.Id] : 0))
								{
									<div class="d-flex justify-content-between">
										<label>@modality.ModalityName</label>
										@if (Model.ModalityCount.ContainsKey(modality.Id))
										{
											<span> @Model.ModalityCount[modality.Id]</span>
										}
										else
										{
											<span> 0</span>
										}
									</div>
								}
							</div>
						</div>

						<div class="col-12 pt-4">
							<label><h6>Part of Day</h6></label>
							<hr />
							<div class="col-12 px-2" id="partofdays">
								@foreach (var partOfDay in Model.PartOfDayList.OrderByDescending(x => Model.PartOfDayCount.ContainsKey(x.Id) ? Model.PartOfDayCount[x.Id] : 0))
								{
									<div class="d-flex justify-content-between">
										<label>@partOfDay.PartOfDayValue</label>
										@if (Model.PartOfDayCount.ContainsKey(partOfDay.Id))
										{
											<span> @Model.PartOfDayCount[partOfDay.Id]</span>
										}
										else
										{
											<span> 0</span>
										}
									</div>
								}
							</div>
						</div>

						<div class="col-12 pt-4">
							<label><h6>Campuses</h6></label>
							<hr />
							<div class="col-12 px-2" id="campuses">
								@foreach (var campus in Model.CampusList.OrderByDescending(x => Model.CampusCount.ContainsKey(x.Id) ? Model.CampusCount[x.Id] : 0))
								{
									<div class="d-flex justify-content-between">
										<label>@campus.CampusName</label>
										@if (Model.CampusCount.ContainsKey(campus.Id))
										{
											<span> @Model.CampusCount[campus.Id]</span>
										}
										else
										{
											<span> 0</span>
										}
									</div>
								}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--Form-->
		<div class="col-9 mx-0">
			<!--Instructor Report-->
			<div class="mb-2">
				<div class="card overflow-auto" style="height: 400px">
					<div class="card-header">
						<h5>Instructor Report</h5>
						<p>Number of Instructors in Report: @Model.instructorReport.Count</p>
					</div>

					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th scope="col">Rank</th>
									<th scope="col">Name</th>
									<th scope="col">Load</th>
									<th scope="col">Modality</th>
									<th scope="col">Time</th>
									<th scope="col">Location</th>
								</tr>
							</thead>
							<tbody>
								@for (int i = 0; i < Model.instructorReport.Count; i++) {
									<tr>
										<th scope="row">@Model.instructorReport[i].ranking</th>
										<td>@Model.instructorReport[i].wishlist.ApplicationUser.FullName</td>
										<td>@Model.instructorReport[i].totalLoadApplied/@Model.instructorReport[i].loadReqAmount</td>
										<td>

											@for (int t = 0; t < Model.instructorReport[i].modalityList.Count; t++) {
												<p>@Model.instructorReport[i].modalityList[t]</p>
											}
										</td>
										<td>
											<button class="btn btn-outline-secondary rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTime@(i)" aria-expanded="false" aria-controls="collapseExample" style="width:150px">
												Times
											</button>
											<div class="collapse" id="collapseTime@(i)">
												<div class="card card-body border-0">
													@for (int t = 0; t < Model.instructorReport[i].timeList.Count; t++) {
														<p>@Model.instructorReport[i].timeList[t]</p>
													}
												</div>
											</div>
											
										</td>
										<td>
											@for (int t = 0; t < Model.instructorReport[i].locationList.Count; t++) {
												<p>@Model.instructorReport[i].locationList[t]</p>
											}
										</td>
									</tr>
								}
							</tbody>
						</table>

					</div>
				</div> <!--Close Container-->
			</div>
			<div class="mb-2">
				<div class="border p-3">
					<form method="post" class="row">
						<input type="hidden" asp-for="objCourseSection.Id">
						<input type="hidden" asp-for="objCourseSection.SemesterInstanceId">
						<div class="row">
							<div class="form-group col-6">
								<div class="row">
									<div class="form-group col-6">
										<label class="form-label">BannerCRN</label>
										<input asp-for="objCourseSection.BannerCRN" class="form-control border-0 shadow" />
									</div>
									<div class="form-group col-6">
										<label class="form-label">Section Status</label>
										<select id="ddlSectionStatus" asp-for="objCourseSection.SectionStatusId" asp-items="@Model.SectionStatusList" class="form-select shadow">
											<option disabled selected>--Select Section Status--</option>
										</select>
									</div>
								</div>
								<div class="row mt-3">
									<div class="form-group col-6">
										<label class="ms-2">First Day Enrollment</label>
										<input asp-for="objCourseSection.SectionFirstDayEnrollment" type="date" class="form-control border-0 shadow" />
									</div>
									<div class="form-group col-6">
										<label class="ms-2">Final Day Enrollment</label>
										<input asp-for="objCourseSection.SectionFinalEnrollment" type="date" class="form-control border-0 shadow" />
									</div>
								</div>
								<div class="row mt-3">
									<div class="form-group col-6">
										<label class="ms-2">Section Updated</label>
										<input asp-for="objCourseSection.SectionUpdated" type="date" class="form-control border-0 shadow" />
									</div>
									<div class="form-group col-6">
										<label class="ms-2">Banner Updated</label>
										<input asp-for="objCourseSection.SectionBannerUpdated" type="date" class="form-control border-0 shadow" />
									</div>
								</div>
							</div>
							<div class="form-group col-6">
								<label class="form-label">Section Notes</label>
								<textarea asp-for="objCourseSection.SectionNotes" class="form-control border-0 shadow" style="height: 85%"></textarea>
							</div>
						</div>
						<div class="row">
							<div class="form-group">
								<label class="form-label mt-2">Course</label>
								<select id="ddlCourse" asp-for="objCourseSection.CourseId" asp-items="@Model.CourseList" class="form-select shadow">
									<option disabled selected>--Select Course--</option>
								</select>
							</div>
						</div>
						<div class="row">
							<div class="form-group col-3">
								<label class="form-label mt-2">Instructor</label>
								<select id="ddlInstructor" asp-for="objCourseSection.InstructorId" asp-items="@Model.InstructorList" class="form-select shadow">
									<option disabled selected>--Select Instructor--</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label class="form-label mt-2">Classroom</label>
								<select id="ddlClassroom" asp-for="objCourseSection.ClassroomId" asp-items="@Model.ClassroomList" class="form-select shadow">
									<option disabled selected>--Select Classroom--</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label class="form-label mt-2">Day Of The Week</label>
								<select id="ddlDaysOfWeek" asp-for="objCourseSection.DaysOfWeekId" asp-items="@Model.DaysOfWeekList" class="form-select shadow">
									<option disabled selected>--Select Day of the Week--</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label class="form-label mt-2">Time Slot</label>
								<select id="ddlTimeBlock" asp-for="objCourseSection.TimeBlockId" asp-items="@Model.TimeBlockList" class="form-select shadow">
									<option disabled selected>--Select Time Slot--</option>
								</select>
							</div>
						</div>
						<div class="row mb-3">
							<div class="form-group col-3">
								<label class="form-label mt-2">Modality</label>
								<select id="ddlModality" asp-for="objCourseSection.ModalityId" asp-items="@Model.ModalityList" class="form-select shadow">
									<option disabled selected>--Select Modality--</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label class="form-label mt-2">Part Of Term</label>
								<select id="ddlPartOfTerm" asp-for="objCourseSection.PartOfTermId" asp-items="@Model.PartOfTermList" class="form-select shadow">
									<option disabled selected>--Select Part of the Term--</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label class="form-label mt-2">Pay Model</label>
								<select id="ddlPayModel" asp-for="objCourseSection.PayModelId" asp-items="@Model.PayModelList" class="form-select shadow">
									<option disabled selected>--Select Pay Model--</option>
								</select>
							</div>
							<div class="form-group col-3">
								<label class="form-label mt-2">Pay Organization</label>
								<select id="ddlPayOrganization" asp-for="objCourseSection.PayOrganizationId" asp-items="@Model.PayOrganizationList" class="form-select shadow">
									<option disabled selected>--Select Pay Organization--</option>
								</select>
							</div>
						</div>
						<div class="row pt-2">
							<div class="col-6">
								<button type="submit" class="btn btn-primary form-control">@(Model.objCourseSection.Id != 0 ? "Update " : "Add ")</button>
							</div>
							<div class="col-6">
								<a href="/Coord/BuildSchedule/Sections?semesterInstanceId=@Model.objSemesterInstance.Id" class=" btn btn-outline-primary border form-control">
									Back to List
								</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
</div>
@section Scripts{
	<script>
		//Sort the options for the Courses
		var select = document.getElementById("ddlCourse");
		var selectedValue = select.value;
		var options = Array.from(select.options);
		options.shift(); // Remove the disabled option from the array
		options.sort((a, b) => a.text.localeCompare(b.text));
		select.innerHTML = ""; // Clear the select element
		options.forEach((option) => {
			select.appendChild(option);
		});
		select.value = selectedValue; // Set the selected value back

		//Sort the options for the Time Blocks
		var select = document.getElementById("ddlTimeBlock");
		var selectedValue = select.value;
		var options = Array.from(select.options);
		options.shift(); // Remove the disabled option from the array
		options.sort((a, b) => a.text.localeCompare(b.text));
		select.innerHTML = ""; // Clear the select element
		options.forEach((option) => {
			select.appendChild(option);
		});
		select.value = selectedValue; // Set the selected value back
	</script>
}